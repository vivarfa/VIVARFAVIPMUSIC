<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contenido Gratuito | VIVARFA VIP MUSIC</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Descarga contenido gratuito de mÃºsica para DJs. Samples, loops, packs de audio y video sin costo. Actualizaciones regulares.">
    <meta name="keywords" content="mÃºsica gratis, samples gratuitos, loops free, packs gratis, reggaeton free, cumbia gratis, DJ free">
    <meta name="theme-color" content="#9333ea">
    <link rel="canonical" href="https://www.vivarfa.com/free/">
    
    <!-- Script de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts y Font Awesome -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- CSS Personalizado (si tienes archivos CSS externos) -->
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../animations.css">
    
    <style>
        /* Estilos para gradientes, animaciones y scrollbar (del archivo original) */
        .gradient-text {
            background: linear-gradient(135deg, #06d6a0, #118ab2, #073b4c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .section-background {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
        }
        .fade-in { animation: fadeIn 1s ease-in; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }
        
        @keyframes glow {
            0%, 100% {
                box-shadow: 0 0 5px rgba(147, 51, 234, 0.5);
            }
            50% {
                box-shadow: 0 0 20px rgba(147, 51, 234, 0.8), 0 0 30px rgba(236, 72, 153, 0.6);
            }
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        
        .animate-fadeInUp {
            animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .animate-slideInLeft {
            animation: slideInLeft 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .animate-slideInRight {
            animation: slideInRight 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .animate-scaleIn {
            animation: scaleIn 0.7s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .animate-pulse-slow {
            animation: pulse 3s ease-in-out infinite;
        }
        
        .animate-glow {
            animation: glow 2s ease-in-out infinite;
        }
        
        .floating-animation {
            animation: float 3s ease-in-out infinite;
        }
        .item-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3), 0 0 20px rgba(147, 51, 234, 0.2);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .controls-section {
            background: rgba(31, 41, 55, 0.8);
            backdrop-filter: blur(10px);
            animation: fadeInUp 0.8s ease-out 0.2s both;
        }
        
        .search-input:focus {
            box-shadow: 0 0 0 3px rgba(147, 51, 234, 0.1);
            transform: scale(1.02);
            transition: all 0.3s ease;
        }
        
        .filter-select:focus {
            box-shadow: 0 0 0 3px rgba(147, 51, 234, 0.1);
            transform: scale(1.02);
            transition: all 0.3s ease;
        }
        
        .stats-bar {
            background: linear-gradient(90deg, rgba(147, 51, 234, 0.1) 0%, rgba(236, 72, 153, 0.1) 100%);
            animation: slideInLeft 0.8s ease-out 0.4s both;
        }
        
        .breadcrumb-item {
            transition: all 0.2s ease;
        }
        
        .breadcrumb-item:hover {
            color: #9333ea;
            transform: translateY(-1px);
        }
        
        .download-btn {
            background: linear-gradient(135deg, #9333ea 0%, #ec4899 100%);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .download-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .download-btn:hover::before {
            left: 100%;
        }
        
        .download-btn:hover {
            background: linear-gradient(135deg, #7c3aed 0%, #db2777 100%);
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 25px rgba(147, 51, 234, 0.4), 0 0 20px rgba(236, 72, 153, 0.3);
        }
        
        .animate-scaleIn {
            opacity: 0;
            transform: scale(0.9);
            animation: scaleIn 0.7s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        
        .stagger-animation {
            animation-fill-mode: both;
        }
        
        .stagger-animation:nth-child(1) { animation-delay: 0.05s; }
        .stagger-animation:nth-child(2) { animation-delay: 0.1s; }
        .stagger-animation:nth-child(3) { animation-delay: 0.15s; }
        .stagger-animation:nth-child(4) { animation-delay: 0.2s; }
        .stagger-animation:nth-child(5) { animation-delay: 0.25s; }
        .stagger-animation:nth-child(6) { animation-delay: 0.3s; }
        .stagger-animation:nth-child(7) { animation-delay: 0.35s; }
        .stagger-animation:nth-child(8) { animation-delay: 0.4s; }
        .stagger-animation:nth-child(9) { animation-delay: 0.45s; }
        .stagger-animation:nth-child(10) { animation-delay: 0.5s; }
        
        .feature-icon {
            transition: all 0.3s ease;
        }
        
        .feature-icon:hover {
            transform: scale(1.2) rotate(5deg);
            color: #ec4899;
        }
        
        .stat-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .stat-card:hover {
            transform: translateY(-2px) scale(1.05);
            background: rgba(31, 41, 55, 0.8);
            box-shadow: 0 8px 25px rgba(147, 51, 234, 0.2);
        }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #374151; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #06d6a0; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #059669; }
        @media (max-width: 768px) {
            .grid-responsive { grid-template-columns: 1fr; }
        }
    </style>
    
    <link rel="icon" href="../logo.png" type="image/png">

    <!-- Script de Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9975952999842017" crossorigin="anonymous"></script>
</head>
<body class="bg-gray-900 text-white font-sans antialiased">
    <!-- Header -->
    <header class="bg-gray-900/80 backdrop-blur-lg sticky top-0 z-50 border-b border-gray-700">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center py-3">
            <a href="/" class="flex items-center gap-3 cursor-pointer hover-scale">
                <img src="../images/vivarfa.png" alt="Vivarfa VIP Music Logo" class="h-10 w-10 object-contain animate-float">
                <span class="text-xl md:text-2xl font-bold" style="background-image: linear-gradient(to right, #9333ea, #ec4899); -webkit-background-clip: text; background-clip: text; color: transparent;">VIVARFA VIP MUSIC</span>
            </a>
            <ul class="hidden md:flex items-center space-x-6">
                <li><a href="/" class="nav-link">Inicio</a></li>
                <li><a href="/membresias/" class="nav-link">MembresÃ­as</a></li>
                <li><a href="/audio-packs/" class="nav-link">Audio Packs</a></li>
                <li><a href="/video-packs/" class="nav-link">Video Packs</a></li>
                <li><a href="/backups/" class="nav-link">Backups</a></li>
                <li><a href="/tutoriales/" class="nav-link">Tutoriales</a></li>
                <li><a href="/free/" class="nav-link active">Gratis</a></li>
            </ul>
            <button id="mobile-menu-button" class="md:hidden text-white text-2xl hover-scale">
                <i class="fas fa-bars"></i>
            </button>
        </nav>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-gray-800/95 backdrop-blur-sm">
            <ul class="flex flex-col items-center py-4 space-y-4">
                 <li><a href="/" class="nav-link">Inicio</a></li>
                 <li><a href="/membresias/" class="nav-link">MembresÃ­as</a></li>
                 <li><a href="/audio-packs/" class="nav-link">Audio Packs</a></li>
                 <li><a href="/video-packs/" class="nav-link">Video Packs</a></li>
                 <li><a href="/backups/" class="nav-link">Backups</a></li>
                 <li><a href="/tutoriales/" class="nav-link">Tutoriales</a></li>
                 <li><a href="/free/" class="nav-link active">Gratis</a></li>
            </ul>
        </div>
    </header>

    <!-- Loading Spinner -->
    <div id="loading" class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 hidden">
        <div class="w-12 h-12 border-4 border-gray-600 border-t-purple-500 rounded-full animate-spin"></div>
    </div>

    <!-- WhatsApp Button -->
    <div id="whatsapp-chat-widget" class="animate-fadeInUp">
        <div class="whatsapp-chat-window">
            <div class="whatsapp-header">
                <div class="flex items-center">
                    <img src="../images/vivarfa.png" alt="Vivarfa VIP Music Logo" class="h-8 w-8 object-contain mr-2">
                    <div>
                        <div class="title">VIVARFA VIP MUSIC</div>
                        <div class="subtitle">Â¿CÃ³mo podemos ayudarte?</div>
                    </div>
                </div>
            </div>
            <div class="whatsapp-body">
                <div class="whatsapp-message">
                    <div class="flex items-start">
                        <div class="flex-shrink-0 mr-3">
                            <img src="../images/vivarfa.png" alt="Vivarfa VIP Music Logo" class="h-8 w-8 object-contain rounded-full">
                        </div>
                        <div>
                            <p class="text-xs text-gray-400 mb-1">Soporte VIVARFA</p>
                            <div class="bg-gray-700 p-3 rounded-lg">
                                Hola ðŸ‘‹<br>Â¡Bienvenido a VIVARFA VIP MUSIC!<br>Â¿En quÃ© podemos ayudarte hoy?
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="whatsapp-footer">
                <input id="whatsapp-message-input" type="text" placeholder="Escribe tu mensaje...">
                <button id="whatsapp-send-btn" class="animate-pulse">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
        <button id="whatsapp-chat-toggle" class="whatsapp-chat-toggle">
            <i class="fab fa-whatsapp"></i>
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <main>
        <!-- SecciÃ³n de Contenido Gratuito -->
        <section class="min-h-screen section-background py-20 fade-in">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-16">
                    <div class="inline-block bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-2 rounded-full text-sm font-semibold mb-4 animate-fadeInUp floating-animation">
                        <i class="fas fa-gift mr-2"></i>CONTENIDO GRATUITO
                    </div>
                    <h1 class="text-5xl md:text-6xl font-bold bg-gradient-to-r from-purple-600 via-pink-600 to-purple-800 bg-clip-text text-transparent mb-6 animate-fadeInUp" style="animation-delay: 0.2s">
                        Packs Free Exclusivos
                    </h1>
                    <p class="text-xl text-gray-400 max-w-3xl mx-auto leading-relaxed animate-fadeInUp" style="animation-delay: 0.4s">
                        Descarga contenido gratuito de alta calidad. Samples, loops, packs de audio y video sin costo. Actualizaciones regulares.
                    </p>
                    <div class="flex justify-center items-center gap-8 mt-8 text-sm text-gray-500 flex-wrap animate-fadeInUp" style="animation-delay: 0.6s">
                        <div class="flex items-center gap-2 animate-pulse-slow">
                            <i class="fas fa-download feature-icon text-purple-500"></i>
                            <span>Descarga Directa</span>
                        </div>
                        <div class="flex items-center gap-2 animate-pulse-slow" style="animation-delay: 0.5s">
                            <i class="fas fa-sync-alt feature-icon text-purple-500"></i>
                            <span>Actualizaciones Regulares</span>
                        </div>
                        <div class="flex items-center gap-2 animate-pulse-slow" style="animation-delay: 1s">
                            <i class="fas fa-shield-alt feature-icon text-purple-500"></i>
                            <span>100% Seguro</span>
                        </div>
                        <div class="flex items-center gap-2 animate-pulse-slow" style="animation-delay: 1.5s">
                            <i class="fas fa-heart feature-icon text-purple-500"></i>
                            <span>Sin Costo</span>
                        </div>
                    </div>
                </div>

                <!-- Controles de bÃºsqueda y filtros -->
                <div class="controls-section bg-gray-800/50 backdrop-blur-sm rounded-2xl shadow-lg p-6 mb-8 border border-gray-700 animate-slideInLeft">
                    <div class="mb-6 animate-fadeInUp" style="animation-delay: 0.2s">
                        <div class="relative">
                            <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input type="text" id="search-input" class="search-input w-full pl-12 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent hover:bg-gray-600/80 focus:scale-105" placeholder="Buscar packs, archivos o contenido...">
                        </div>
                    </div>
                    <div class="flex flex-wrap gap-4 animate-fadeInUp" style="animation-delay: 0.4s">
                        <div class="flex flex-col">
                            <label for="type-filter" class="text-sm text-gray-400 mb-2">Tipo:</label>
                            <select id="type-filter" class="filter-select px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500 hover:bg-gray-600/80 focus:scale-105">
                                <option value="all">Todos</option>
                                <option value="folder">Carpetas</option>
                                <option value="audio">Audio</option>
                                <option value="video">Video</option>
                            </select>
                        </div>
                        <div class="flex flex-col">
                            <label for="sort-filter" class="text-sm text-gray-400 mb-2">Ordenar:</label>
                            <select id="sort-filter" class="filter-select px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500 hover:bg-gray-600/80 focus:scale-105">
                                <option value="name">Nombre A-Z</option>
                                <option value="name-desc">Nombre Z-A</option>
                                <option value="date">MÃ¡s reciente</option>
                                <option value="date-desc">MÃ¡s antiguo</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- EstadÃ­sticas -->
                 <div class="stats-bar grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                     <div class="stat-card bg-gray-800/50 backdrop-blur-sm rounded-xl p-4 text-center border border-gray-700 animate-scaleIn">
                         <div class="text-2xl font-bold text-purple-500" id="total-items">0</div>
                         <div class="text-sm text-gray-400">Total Items</div>
                     </div>
                     <div class="stat-card bg-gray-800/50 backdrop-blur-sm rounded-xl p-4 text-center border border-gray-700 animate-scaleIn" style="animation-delay: 0.1s">
                         <div class="text-2xl font-bold text-pink-500" id="packs-count">0</div>
                         <div class="text-sm text-gray-400">Carpetas</div>
                     </div>
                     <div class="stat-card bg-gray-800/50 backdrop-blur-sm rounded-xl p-4 text-center border border-gray-700 animate-scaleIn" style="animation-delay: 0.2s">
                         <div class="text-2xl font-bold text-purple-400" id="files-count">0</div>
                         <div class="text-sm text-gray-400">Archivos</div>
                     </div>
                     <div class="stat-card bg-gray-800/50 backdrop-blur-sm rounded-xl p-4 text-center border border-gray-700 animate-scaleIn" style="animation-delay: 0.3s">
                         <div class="text-2xl font-bold text-pink-400" id="filtered-count">0</div>
                         <div class="text-sm text-gray-400">Mostrando</div>
                     </div>
                 </div>

                <!-- NavegaciÃ³n y breadcrumbs -->
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                    <div id="breadcrumb" class="flex items-center text-sm text-gray-400 flex-wrap"></div>
                    <a id="download-all-btn" class="download-btn inline-flex items-center px-6 py-3 bg-gradient-to-r from-green-600 to-teal-600 text-white rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 opacity-0 pointer-events-none" target="_blank" style="transition: opacity 0.3s;">
                        <i class="fas fa-download mr-2"></i> Descargar Pack Completo
                    </a>
                </div>

                <!-- Header de lista -->
                <div id="list-header" class="hidden"></div>

                <!-- Lista de contenido -->
                <div id="content-list" class="space-y-4"></div>

                <!-- Estado vacÃ­o -->
                <div id="empty-state" class="text-center py-12 hidden" style="transition: opacity 0.5s;">
                    <i class="fas fa-search text-4xl text-gray-500 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-400 mb-2">No se encontraron resultados</h3>
                    <p class="text-gray-500">Intenta con otros tÃ©rminos de bÃºsqueda</p>
                </div>
                
                <!-- SecciÃ³n de CTA -->
                <div class="text-center mt-16">
                    <div class="bg-gray-800/50 backdrop-blur-sm rounded-2xl shadow-lg p-8 md:p-12 border border-gray-700">
                        <h3 class="text-3xl font-bold gradient-text mb-4">Â¿Te gustÃ³ el contenido gratuito?</h3>
                        <p class="text-gray-300 text-lg mb-8">Ãšnete a nuestras membresÃ­as VIP y obtÃ©n acceso a miles de packs premium con actualizaciones semanales.</p>
                        <div class="flex flex-col sm:flex-row gap-4 justify-center">
                            <a href="/membresias/" class="inline-flex items-center justify-center px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl font-semibold hover:from-purple-700 hover:to-pink-700 transition-all duration-300 transform hover:scale-105">
                                <i class="fas fa-crown mr-3"></i>Ver MembresÃ­as
                            </a>
                            <a href="https://wa.me/51917776934" target="_blank" class="inline-flex items-center justify-center px-6 py-3 border-2 border-purple-500 text-white rounded-xl font-semibold hover:bg-purple-500 hover:border-purple-500 transition-all duration-300 transform hover:scale-105">
                                <i class="fab fa-whatsapp mr-3"></i>Contactar
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 border-t border-gray-800 pt-16 pb-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
                <div>
                    <div class="flex items-center gap-3 mb-4">
                        <img src="../images/vivarfa.png" alt="Vivarfa VIP Music Logo" class="h-10 w-10 object-contain">
                        <span class="text-xl md:text-2xl font-bold" style="background-image: linear-gradient(to right, #9333ea, #ec4899); -webkit-background-clip: text; background-clip: text; color: transparent;">VIVARFA VIP MUSIC</span>
                    </div>
                    <p class="text-gray-400 mb-4">Tu fuente premium de audio y video para DJs y productores. Actualizaciones semanales con el mejor contenido.</p>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-4 text-white">Enlaces RÃ¡pidos</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="/" class="hover:text-white transition-colors">Inicio</a></li>
                        <li><a href="/membresias/" class="hover:text-white transition-colors">MembresÃ­as</a></li>
                        <li><a href="/audio-packs/" class="hover:text-white transition-colors">Audio Packs</a></li>
                        <li><a href="/video-packs/" class="hover:text-white transition-colors">Video Packs</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-4 text-white">Recursos</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="/backups/" class="hover:text-white transition-colors">Backups</a></li>
                        <li><a href="/free/" class="hover:text-white transition-colors">Contenido Gratuito</a></li>
                        <li><a href="/faq/" class="hover:text-white transition-colors">Preguntas Frecuentes</a></li>
                        <li><a href="/dj-resources/" class="hover:text-white transition-colors">Recursos DJ</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-4 text-white">InformaciÃ³n</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="/contact/" class="hover:text-white transition-colors">Contacto</a></li>
                        <li><a href="/privacy/" class="hover:text-white transition-colors">PolÃ­tica de Privacidad</a></li>
                        <li><a href="/about/" class="hover:text-white transition-colors">Nosotros</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="border-t border-gray-800 pt-8 mt-8 text-center">
                <p class="text-gray-500">Â© 2025 VIVARFA VIP MUSIC. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <script>
        // --- SCRIPT UNIFICADO Y CORREGIDO ---

        // Google Apps Script Configuration
        const apiUrl = 'https://script.google.com/macros/s/AKfycbxoykeSAThO3q36tta49-BGU1fbDpD1eHw6v0HltNuUwAoADjCXYp8JRy4FXyx_l-eg/exec';
        const rootFolderId = "1ZTgkPuwUQBbt1Dor409S5zh2E_7jj90q";
        
        // UI Elements
        const elements = {
            loading: document.getElementById('loading'),
            contentList: document.getElementById('content-list'),
            searchInput: document.getElementById('search-input'),
            typeFilter: document.getElementById('type-filter'),
            sortFilter: document.getElementById('sort-filter'),
            breadcrumb: document.getElementById('breadcrumb'),
            downloadAllBtn: document.getElementById('download-all-btn'),
            listHeader: document.getElementById('list-header'),
            emptyState: document.getElementById('empty-state'),
            totalItems: document.getElementById('total-items'),
            packsCount: document.getElementById('packs-count'),
            filesCount: document.getElementById('files-count'),
            filteredCount: document.getElementById('filtered-count')
        };
        
        // Global state
        let allItems = [];
        let filteredItems = [];
        let folderHistory = [];
        let currentFolder = { id: rootFolderId, name: "Packs Free" };
        
        // Utility functions
        function formatFileSize(bytes) {
            if (!bytes || bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function formatDate(dateString) {
            if (!dateString) return 'Free';
            return new Date(dateString).toLocaleDateString('es-ES', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }
        
        function getFileIcon(item) {
            if (item.type === 'folder') {
                return 'fas fa-folder text-yellow-500';
            }
            if (item.type === 'file') {
                switch(item.fileType) {
                    case 'audio': return 'fas fa-music text-green-500';
                    case 'video': return 'fas fa-video text-red-500';
                    default: return 'fas fa-file text-gray-500';
                }
            }
            return 'fas fa-question-circle text-gray-500';
        }
        
        // Loading spinner management
        function showLoading() {
            if (elements.loading) {
                elements.loading.classList.remove('hidden');
            }
        }
        
        function hideLoading() {
            if (elements.loading) {
                elements.loading.classList.add('hidden');
            }
        }
        
        // API function (using Google Apps Script)
        async function fetchFolderContents(folderId) {
            try {
                const url = folderId === rootFolderId ? apiUrl : `${apiUrl}?folderId=${folderId}`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                if(data.status === 'success') {
                    return data.items || [];
                } else {
                    throw new Error(data.message || 'Error en la respuesta del script');
                }
            } catch (error) {
                console.error('Error fetching folder contents:', error);
                return [];
            }
        }
        
        // UI rendering functions
        function renderBreadcrumb() {
            if (!elements.breadcrumb) return;
            
            let breadcrumbHTML = `<a href="#" onclick="loadRootFolder(event)" class="hover:text-purple-500 transition-colors"><i class="fas fa-home mr-1"></i>Inicio</a>`;
            
            folderHistory.forEach((folder, index) => {
                breadcrumbHTML += ` <i class="fas fa-chevron-right mx-2 text-gray-600"></i> `;
                breadcrumbHTML += `<a href="#" onclick="navigateToFolder(event, '${folder.id}', ${index})" class="hover:text-purple-500 transition-colors">${folder.name}</a>`;
            });

            elements.breadcrumb.innerHTML = breadcrumbHTML;
        }
        
        function updateStats() {
            const folders = allItems.filter(item => item.type === 'folder');
            const files = allItems.filter(item => item.type === 'file');
            
            if (elements.totalItems) elements.totalItems.textContent = allItems.length;
            if (elements.packsCount) elements.packsCount.textContent = folders.length;
            if (elements.filesCount) elements.filesCount.textContent = files.length;
            if (elements.filteredCount) elements.filteredCount.textContent = filteredItems.length;
        }
        
        function renderItems() {
            if (!elements.contentList) return;

            // Si no hay items, muestra el estado vacÃ­o y oculta la lista
            if (filteredItems.length === 0) {
                elements.contentList.innerHTML = '';
                if (elements.emptyState) {
                    elements.emptyState.classList.remove('hidden'); // Muestra el div
                }
                return;
            }

            // Si hay items, oculta el estado vacÃ­o
            if (elements.emptyState) {
                elements.emptyState.classList.add('hidden'); // Oculta el div
            }
            
            const itemsHTML = filteredItems.map((item, index) => {
                const isFolder = item.type === 'folder';
                const icon = getFileIcon(item);
                const size = isFolder ? '' : formatFileSize(item.size);
                const date = formatDate(item.dateModified);
                
                return `
                    <div class="bg-gray-800/30 backdrop-blur-sm rounded-lg p-4 border border-gray-700/50 hover:border-purple-500/50 hover:bg-gray-800/50 transition-all duration-300 animate-scaleIn group" style="animation-delay: ${index * 0.05}s">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4 flex-1">
                                <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-purple-600/20 to-pink-600/20 flex items-center justify-center flex-shrink-0">
                                    <i class="${icon} text-lg transition-all duration-300 group-hover:scale-110 text-purple-400"></i>
                                </div>
                                <div class="flex-1 min-w-0">
                                    ${isFolder ? 
                                        `<button onclick="handleFolderClick('${item.id}', '${item.name.replace(/'/g, "\\'")}')" 
                                            class="text-left w-full font-medium text-white hover:text-purple-400 transition-colors truncate">
                                            ${item.name}
                                        </button>
                                        <p class="text-xs text-gray-500 mt-1">Carpeta de mÃºsica</p>` :
                                        `<h3 class="font-medium text-white truncate" title="${item.name}">${item.name}</h3>
                                          <p class="text-xs text-gray-500 mt-1">Archivo de audio</p>`
                                    }
                                </div>
                            </div>
                            <div class="flex items-center space-x-4">
                                 ${!isFolder ? `<div class="text-right hidden sm:block">
                                     <div class="text-sm text-gray-400">${date}</div>
                                 </div>` : ''}
                                ${!isFolder ? 
                                    `<a href="${item.fileUrl}" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation()"
                                        class="px-3 py-1.5 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white rounded-md text-sm transition-all duration-300 transform hover:scale-105 hover:shadow-lg flex items-center space-x-1">
                                        <i class="fas fa-download text-xs"></i>
                                        <span class="hidden sm:inline">Descargar</span>
                                    </a>` : 
                                    `<div class="text-xs text-purple-400 opacity-75">
                                        <i class="fas fa-chevron-right"></i>
                                    </div>`
                                }
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            elements.contentList.innerHTML = itemsHTML;
            
            // Trigger animations for list items
            setTimeout(() => {
                const listItems = elements.contentList.querySelectorAll('.list-item');
                listItems.forEach((item, index) => {
                    setTimeout(() => {
                        item.classList.add('animate-in');
                    }, index * 100);
                });
            }, 50);
        }
        
        // Event handlers
        function handleFolderClick(folderId, folderName) {
            folderHistory.push({ ...currentFolder });
            loadFolderContents({ id: folderId, name: folderName });
        }
        
        function navigateToFolder(event, folderId, historyIndex) {
            event.preventDefault();
            const targetFolder = folderHistory[historyIndex];
            folderHistory = folderHistory.slice(0, historyIndex);
            loadFolderContents(targetFolder);
        }
        
        function loadRootFolder(event) {
            if (event) event.preventDefault();
            folderHistory = [];
            loadFolderContents({ id: rootFolderId, name: "Packs Free" });
        }
        
        // Main loading function
        async function loadFolderContents(folder) {
            showLoading();
            currentFolder = folder;
            
            try {
                allItems = await fetchFolderContents(folder.id);
                applyAndRender();
                renderBreadcrumb();
                
                // Update download all button - only show for folders with music files (final level)
                const hasAudioFiles = allItems.some(item => item.type === 'file' && item.fileType === 'audio');
                const hasOnlyFiles = allItems.every(item => item.type === 'file');
                
                if (elements.downloadAllBtn && currentFolder.id !== rootFolderId && (hasAudioFiles || hasOnlyFiles)) {
                    elements.downloadAllBtn.href = `https://drive.google.com/drive/folders/${currentFolder.id}`;
                    elements.downloadAllBtn.style.opacity = '1';
                    elements.downloadAllBtn.style.pointerEvents = 'auto';
                } else if (elements.downloadAllBtn) {
                    elements.downloadAllBtn.style.opacity = '0';
                    elements.downloadAllBtn.style.pointerEvents = 'none';
                }
                
            } catch (error) {
                console.error('Error loading folder contents:', error);
                if (elements.contentList) {
                    elements.contentList.innerHTML = `
                        <div class="text-center py-12 text-red-400">
                            <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
                            <h3 class="text-xl font-semibold mb-2">Error al cargar el contenido</h3>
                            <p>Por favor, intente mÃ¡s tarde o contacte al soporte.</p>
                        </div>
                    `;
                }
            } finally {
                hideLoading();
            }
        }
        
        function applyAndRender() {
            applyFilters();
            updateStats();
            renderItems();
        }

        // Filter and search functions
        function applyFilters() {
            const searchTerm = elements.searchInput.value.toLowerCase();
            const typeFilterValue = elements.typeFilter.value;
            const sortFilterValue = elements.sortFilter.value;
            
            // Filter by search term and type
            filteredItems = allItems.filter(item => {
                const nameMatch = item.name.toLowerCase().includes(searchTerm);
                if (!nameMatch) return false;
                
                switch (typeFilterValue) {
                    case 'folder': return item.type === 'folder';
                    case 'audio': return item.type === 'file' && item.fileType === 'audio';
                    case 'video': return item.type === 'file' && item.fileType === 'video';
                    default: return true;
                }
            });
            
            // Sort items
            filteredItems.sort((a, b) => {
                // Always put folders first
                const aIsFolder = a.type === 'folder';
                const bIsFolder = b.type === 'folder';
                if (aIsFolder && !bIsFolder) return -1;
                if (!aIsFolder && bIsFolder) return 1;
                
                switch (sortFilterValue) {
                    case 'name-desc': return b.name.localeCompare(a.name);
                    case 'date': return new Date(b.dateModified || 0) - new Date(a.dateModified || 0);
                    case 'date-desc': return new Date(a.dateModified || 0) - new Date(b.dateModified || 0);
                    case 'name':
                    default:
                        return a.name.localeCompare(b.name);
                }
            });
        }
        
        // Event listeners
        elements.searchInput.addEventListener('input', applyAndRender);
        elements.typeFilter.addEventListener('change', applyAndRender);
        elements.sortFilter.addEventListener('change', applyAndRender);
        
        // Mobile menu handling
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        if (mobileMenuButton && mobileMenu) {
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
        }
        
        // WhatsApp chat functionality
        const chatBubble = document.getElementById('chat-bubble');
        const chatTooltip = document.getElementById('chat-tooltip');
        
        if (chatBubble && chatTooltip) {
            chatBubble.addEventListener('mouseenter', () => {
                chatTooltip.classList.remove('opacity-0', 'translate-y-2');
                chatTooltip.classList.add('opacity-100', 'translate-y-0');
            });
            
            chatBubble.addEventListener('mouseleave', () => {
                chatTooltip.classList.add('opacity-0', 'translate-y-2');
                chatTooltip.classList.remove('opacity-100', 'translate-y-0');
            });
            
            chatBubble.addEventListener('click', () => {
                window.open('https://wa.me/51917776934?text=Hola!%20Quisiera%20consultar%20mÃ¡s%20informaciÃ³n%20sobre%20VIVARFA%20VIP%20MUSIC', '_blank');
            });
        }
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            loadRootFolder();
            
            // WhatsApp Chat functionality
            const widget = document.getElementById('whatsapp-chat-widget');
            const toggleButton = document.getElementById('whatsapp-chat-toggle');
            const sendButton = document.getElementById('whatsapp-send-btn');
            const messageInput = document.getElementById('whatsapp-message-input');
            
            if (widget && toggleButton && sendButton && messageInput) {
                const phoneNumber = '51917776934';
                
                toggleButton.addEventListener('click', () => {
                    widget.classList.toggle('open');
                });
                
                sendButton.addEventListener('click', () => {
                    const message = messageInput.value.trim();
                    if (message) {
                        const url = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
                        window.open(url, '_blank', 'noopener,noreferrer');
                        messageInput.value = '';
                        widget.classList.remove('open');
                    }
                });
                
                // Enter key support
                messageInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        sendButton.click();
                    }
                });
            }
        });
    </script>
</body>
</html>